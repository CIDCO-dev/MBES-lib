<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EM datagrams on *.kmall format: Datagram format philosophy</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="KMlogo.PNG"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EM datagrams on *.kmall format
   &#160;<span id="projectnumber">Reg.no. 410224 Revision H</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('philosophy.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Datagram format philosophy </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h3>Philosophy </h3>
<p>One of the motivations for implementing the *.kmall format is to be able to add additional data fields to the datagrams without breaking existing decoders. At the same time, the datagram format shall be backwards compatible when future versions of the specific datagrams (e.g. MRZ, MWC) are released. The datagrams need to be decoded in a specific way to be able to support the two mentioned specifications.</p>
<h3>How to decode the datagrams </h3>
<p>To support backwards compatibility, some of the datagrams start with the number of bytes in the current struct. Let us take the datagram <a class="el" href="structEMdgmMRZ__def.html" title="#MRZ - Multibeam Raw Range and Depth datagram. The datagram also contains seabed image data.">EMdgmMRZ_def</a> as an example. The third struct in <a class="el" href="structEMdgmMRZ__def.html" title="#MRZ - Multibeam Raw Range and Depth datagram. The datagram also contains seabed image data.">EMdgmMRZ_def</a> is <a class="el" href="structEMdgmMbody__def.html" title="Multibeam (M) datagrams - body part. Start of body of all M datagrams.">EMdgmMbody_def</a>. The first data field in <a class="el" href="structEMdgmMbody__def.html" title="Multibeam (M) datagrams - body part. Start of body of all M datagrams.">EMdgmMbody_def</a> contains <em>numBytesCmnPart</em> which is described as denoting the size of current struct. This value tells us how far we shall "jump" to get to the next struct, <a class="el" href="structEMdgmMRZ__pingInfo__def.html" title="#MRZ - ping info. Information on vessel/system level, i.e. information common to all beams in the cur...">EMdgmMRZ_pingInfo_def</a>. If new data fields are added to <a class="el" href="structEMdgmMbody__def.html" title="Multibeam (M) datagrams - body part. Start of body of all M datagrams.">EMdgmMbody_def</a>, the <em>numBytesCmnPart</em> will always make sure we "jump over" the new data fields. If this method is not applied, the first part of <a class="el" href="structEMdgmMRZ__pingInfo__def.html" title="#MRZ - ping info. Information on vessel/system level, i.e. information common to all beams in the cur...">EMdgmMRZ_pingInfo_def</a> will contain data from the new data fields, which will cause the decoding to fail.<br  />
 <br  />
 This decoding methodology is also used for <a class="el" href="structEMdgmMRZ__pingInfo__def.html" title="#MRZ - ping info. Information on vessel/system level, i.e. information common to all beams in the cur...">EMdgmMRZ_pingInfo_def</a>. The first data field is <em>numBytesInfoData</em> which is described as number of bytes in current struct. By applying the method previously presented, we will always get safely to <a class="el" href="structEMdgmMRZ__txSectorInfo__def.html" title="#MRZ - sector information.">EMdgmMRZ_txSectorInfo_def</a> even if new data fields are added to <a class="el" href="structEMdgmMRZ__pingInfo__def.html" title="#MRZ - ping info. Information on vessel/system level, i.e. information common to all beams in the cur...">EMdgmMRZ_pingInfo_def</a>. <br  />
 <br  />
 For <a class="el" href="structEMdgmMRZ__txSectorInfo__def.html" title="#MRZ - sector information.">EMdgmMRZ_txSectorInfo_def</a> there a slightly other method. <a class="el" href="structEMdgmMRZ__pingInfo__def.html" title="#MRZ - ping info. Information on vessel/system level, i.e. information common to all beams in the cur...">EMdgmMRZ_pingInfo_def</a> also contains <em>numTxSectors</em> (Number of transmit sectors) and <em>numBytesPerTxSector</em> (number of bytes in the struct EMdgmMRZ_txSectorInfo). This tells us how far we shall jump from the first byte of <a class="el" href="structEMdgmMRZ__txSectorInfo__def.html" title="#MRZ - sector information.">EMdgmMRZ_txSectorInfo_def</a> to get safely to <a class="el" href="structEMdgmMRZ__rxInfo__def.html" title="#MRZ - receiver specific information.">EMdgmMRZ_rxInfo_def</a>. And again, in <a class="el" href="structEMdgmMRZ__rxInfo__def.html" title="#MRZ - receiver specific information.">EMdgmMRZ_rxInfo_def</a> starts with <em>numBytesRxInfo</em> (Bytes in current struct). <br  />
 <br  />
 <a class="el" href="structEMdgmMRZ__extraDetClassInfo__def.html" title="#MRZ - Extra detection class information.">EMdgmMRZ_extraDetClassInfo_def</a> contains the extra detections data, and contains data if extra detections is enabled, and if so, the number of classes. The size of <a class="el" href="structEMdgmMRZ__extraDetClassInfo__def.html" title="#MRZ - Extra detection class information.">EMdgmMRZ_extraDetClassInfo_def</a> and the number of classes in <a class="el" href="structEMdgmMRZ__rxInfo__def.html" title="#MRZ - receiver specific information.">EMdgmMRZ_rxInfo_def</a>. To get to <a class="el" href="structEMdgmMRZ__sounding__def.html" title="#MRZ - Data for each sounding, e.g. XYZ, reflectivity, two way travel time etc.">EMdgmMRZ_sounding_def</a>, we need to jump <em>numBytesPerClass</em> X <em>numExtraDetectionClasses</em> bytes.<br  />
 <br  />
 The size of <a class="el" href="structEMdgmMRZ__sounding__def.html" title="#MRZ - Data for each sounding, e.g. XYZ, reflectivity, two way travel time etc.">EMdgmMRZ_sounding_def</a> is found in <a class="el" href="structEMdgmMRZ__rxInfo__def.html" title="#MRZ - receiver specific information.">EMdgmMRZ_rxInfo_def</a> in the data field <em>numBytesPerSounding</em> (Bytes per loop of sounding (per depth point)). The number of sounding is found in numSoundingsMaxMain. <br  />
 <br  />
 The last data in <a class="el" href="structEMdgmMRZ__def.html" title="#MRZ - Multibeam Raw Range and Depth datagram. The datagram also contains seabed image data.">EMdgmMRZ_def</a> is the seabed image sample amplitude <em>SIsample_desidB</em>. The number of samples is found in <em>SInumSamples</em> in <a class="el" href="structEMdgmMRZ__sounding__def.html" title="#MRZ - Data for each sounding, e.g. XYZ, reflectivity, two way travel time etc.">EMdgmMRZ_sounding_def</a>.</p>
<p>See the links below an implementation of the decoding of #MRZ:<br  />
 <a href="KMALL__reader_8cpp_source.html">Example of how to decode #MRZ in C++</a> or download <a href="KMALL_reader.cpp" target="_blank">KMALL_reader.cpp</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
